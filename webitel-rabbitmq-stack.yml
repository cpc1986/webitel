version: '3.2'

services:
  rabbitmq1:
    image: webitel/rabbitmq
    hostname: rabbitmq1
    environment:
      - RABBITMQ_DEFAULT_USER=webitel
      - RABBITMQ_DEFAULT_PASS=webitel
      - RABBITMQ_ERLANG_COOKIE="123-SECRET-KEY-987"
    networks:
      - wtel_vlan
    volumes:
      - data1:/var/lib/rabbitmq
    deploy:
      mode: global
      placement:
        constraints: [node.labels.rabbitmq1 == true]
  rabbitmq2:
    image: webitel/rabbitmq
    hostname: rabbitmq2
    environment:
      - RABBITMQ_DEFAULT_USER=webitel
      - RABBITMQ_DEFAULT_PASS=webitel
      - RABBITMQ_ERLANG_COOKIE="123-SECRET-KEY-987"
    networks:
      - wtel_vlan
    volumes:
      - data2:/var/lib/rabbitmq
    deploy:
      mode: global
      placement:
        constraints: [node.labels.rabbitmq2 == true]
  haproxy:
    image: webitel/haproxy-for-rabbitmq
#    ports:
#      - 15672:15672
#      - 5672:5672
#      - 1936:1936
    networks:
      - wtel_vlan
    deploy:
      mode: global

networks:
  wtel_vlan:
    external: true

volumes:
  data1:
  data2:
